<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุชุญูู | ุงูุจุฑู โก</title>
    
    <!-- Google Font: Cairo -->
    <link href='https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap' rel='stylesheet'>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Architect's Professional Stylesheet -->
    <link rel="stylesheet" href="pro-style.css">

</head>
<body class="bg-background-color">

    <!-- === PROFESSIONAL SIDEBAR === -->
    <aside class="sidebar glass-card fixed top-0 right-0 h-full w-72 p-6 z-50 md:z-40">
        <div class="text-center mb-10">
             <div class="flex items-center justify-center gap-2 cursor-pointer" onclick="location.href='index.html'">
                <div class="w-12 h-12 bg-primary-color rounded-2xl flex items-center justify-center shadow-lg rotate-3">
                    <i class="fas fa-bolt text-white text-2xl"></i>
                </div>
                <span class="text-2xl font-black tracking-tighter italic">ููุญุฉ ุงูุชุญูู</span>
            </div>
        </div>

        <nav class="flex flex-col gap-3">
            <a href="#" onclick="openTab('dashboard-tab', this)" class="sidebar-link active"><i class="fas fa-tachometer-alt fa-fw"></i> ุงูุฅุญุตุงุฆูุงุช</a>
            <a href="#" onclick="openTab('management-tab', this)" class="sidebar-link"><i class="fas fa-utensils fa-fw"></i> ุฅุฏุงุฑุฉ ุงููุญุชูู</a>
            <a href="#" id="users-nav-btn" onclick="openTab('users-tab', this)" class="sidebar-link hidden"><i class="fas fa-users-cog fa-fw"></i> ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช</a>
            <a href="#" onclick="openTab('settings-tab', this)" class="sidebar-link"><i class="fas fa-user-circle fa-fw"></i> ุฅุนุฏุงุฏุงุช ุญุณุงุจู</a>
        </nav>

        <div class="absolute bottom-6 left-6 right-6 p-4 rounded-2xl bg-secondary-color text-white">
            <div class="flex justify-between items-center">
                <span id="userNameDisplay" class="font-bold"></span>
                <button onclick="logout()" class="text-red-400 hover:text-red-500 font-bold text-sm"><i class="fas fa-sign-out-alt"></i> ุฎุฑูุฌ</button>
            </div>
             <div class="theme-switcher mt-4 !static !w-full !justify-center !bg-white/10" id="theme-switcher">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <header class="md:hidden p-4 glass-card sticky top-4 mx-4 z-40 flex justify-between items-center">
        <span class="font-black text-lg">ููุญุฉ ุงูุชุญูู</span>
        <button id="menu-toggle" class="p-2">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </header>

    <main class="main-content p-6 md:p-10">

        <!-- === DASHBOARD TAB === -->
        <div id="dashboard-tab" class="tab-content active">
            <h1 class="text-3xl font-black mb-8">ูุฑุญุจุงู <span id="welcome-name">...</span> ๐</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Stat Card: Total Restaurants -->
                <div class="stat-card reveal-on-load glass-card p-6 flex items-center justify-between">
                    <div>
                        <p class="text-sm font-bold text-text-light-color">ุฅุฌูุงูู ุงููุทุงุนู</p>
                        <p id="total-restaurants" class="text-3xl font-black mt-1">0</p>
                    </div>
                    <i class="fas fa-store-alt text-4xl text-primary-color opacity-50"></i>
                </div>
                <!-- Stat Card: Total Meals -->
                <div class="stat-card reveal-on-load glass-card p-6 flex items-center justify-between" style="animation-delay: 0.1s;">
                    <div>
                        <p class="text-sm font-bold text-text-light-color">ุฅุฌูุงูู ุงููุฌุจุงุช</p>
                        <p id="total-meals" class="text-3xl font-black mt-1">0</p>
                    </div>
                    <i class="fas fa-hamburger text-4xl text-primary-color opacity-50"></i>
                </div>
                 <!-- Stat Card: Total Offers -->
                <div class="stat-card reveal-on-load glass-card p-6 flex items-center justify-between" style="animation-delay: 0.2s;">
                    <div>
                        <p class="text-sm font-bold text-text-light-color">ุงูุนุฑูุถ ุงููุชุงุญุฉ</p>
                        <p id="total-offers" class="text-3xl font-black mt-1">0</p>
                    </div>
                    <i class="fas fa-tags text-4xl text-primary-color opacity-50"></i>
                </div>
                <!-- Stat Card: Total Users -->
                <div class="stat-card reveal-on-load glass-card p-6 flex items-center justify-between" style="animation-delay: 0.3s;">
                    <div>
                        <p class="text-sm font-bold text-text-light-color">ุนุฏุฏ ุงููุณุชุฎุฏููู</p>
                        <p id="total-users" class="text-3xl font-black mt-1">0</p>
                    </div>
                    <i class="fas fa-users text-4xl text-primary-color opacity-50"></i>
                </div>
            </div>
        </div>

        <!-- === CONTENT MANAGEMENT TAB === -->
        <div id="management-tab" class="tab-content">
             <h1 class="text-3xl font-black mb-8">ุฅุฏุงุฑุฉ ุงููุญุชูู</h1>
             <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Column 1: Add Restaurant / Offer -->
                <div class="lg:col-span-1 space-y-8">
                    <div class="reveal-on-load glass-card p-6">
                        <h3 class="font-black text-lg mb-4 text-primary-color"><i class="fas fa-plus-circle ml-1"></i> ุฅุถุงูุฉ ูุทุนู</h3>
                        <input type="text" id="resName" class="admin-input mb-3" placeholder="ุงุณู ุงููุทุนู">
                        <input type="text" id="resImg" class="admin-input mb-3" placeholder="ุฑุงุจุท ุตูุฑุฉ ุงููุทุนู">
                        <button onclick="addRestaurant()" class="admin-btn primary">ุญูุธ ุงููุทุนู</button>
                    </div>
                     <div class="reveal-on-load glass-card p-6">
                        <h3 class="font-black text-lg mb-4 text-primary-color"><i class="fas fa-hamburger ml-1"></i> ุฅุถุงูุฉ ูุฌุจุฉ</h3>
                        <select id="resSelect" class="admin-input mb-3"></select>
                        <input type="text" id="foodName" class="admin-input mb-3" placeholder="ุงุณู ุงููุฌุจุฉ">
                        <input type="number" id="foodPrice" class="admin-input mb-3" placeholder="ุงูุณุนุฑ">
                        <button onclick="addFood()" class="admin-btn primary">ุฅุถุงูุฉ ุงููุฌุจุฉ</button>
                    </div>
                    <div class="reveal-on-load glass-card p-6">
                        <h3 class="font-black text-lg mb-4 text-primary-color"><i class="fas fa-tag ml-1"></i> ุฅุถุงูุฉ ุนุฑุถ ุฌุฏูุฏ</h3>
                        <input type="text" id="offerName" class="admin-input mb-3" placeholder="ุงุณู ุงูุนุฑุถ/ุงููุฌุจุฉ">
                        <input type="number" id="offerPrice" class="admin-input mb-3" placeholder="ุณุนุฑ ุงูุนุฑุถ">
                        <input type="text" id="offerImg" class="admin-input mb-3" placeholder="ุฑุงุจุท ุตูุฑุฉ ุงูุนุฑุถ">
                        <input type="text" id="offerRes" class="admin-input mb-3" placeholder="ุงุณู ุงููุทุนู (ุงุฎุชูุงุฑู)">
                        <button onclick="addOffer()" class="admin-btn primary">ุฅุถุงูุฉ ุงูุนุฑุถ</button>
                    </div>
                </div>

                <!-- Column 2: View Data -->
                <div class="lg:col-span-2 reveal-on-load glass-card p-6">
                    <h3 class="font-black text-xl mb-6">ุงูุจูุงูุงุช ุงููุณุฌูุฉ</h3>
                    <div class="overflow-x-auto">
                        <h4 class="font-bold mb-2">ุงููุทุงุนู ูุงููุฌุจุงุช:</h4>
                        <table class="w-full text-right mb-8">
                           <thead class="border-b border-border-color text-sm text-text-light-color">
                                <tr><th class="p-2">ุงููุทุนู</th><th class="p-2">ุงููุฌุจุงุช</th><th class="p-2"></th></tr>
                            </thead>
                            <tbody id="resTableBody"></tbody>
                        </table>
                        <h4 class="font-bold mb-2">ุงูุนุฑูุถ:</h4>
                        <table class="w-full text-right">
                             <thead class="border-b border-border-color text-sm text-text-light-color">
                                <tr><th class="p-2">ุงูุนุฑุถ</th><th class="p-2">ุงูุณุนุฑ</th><th class="p-2"></th></tr>
                            </thead>
                            <tbody id="offersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- === USERS TAB === -->
        <div id="users-tab" class="tab-content">
            <h1 class="text-3xl font-black mb-8">ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช</h1>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                 <div class="reveal-on-load glass-card p-6">
                    <h3 class="font-black text-lg mb-4">ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ</h3>
                    <input type="text" id="newStaffName" class="admin-input mb-3" placeholder="ุงุณู ุงูููุธู">
                    <input type="password" id="newStaffPass" class="admin-input mb-3" placeholder="ูููุฉ ุงูุณุฑ">
                    <select id="newStaffRole" class="admin-input mb-4">
                        <option value="staff">ููุธู (ุฅุถุงูุฉ ููุท)</option>
                        <option value="admin">ูุฏูุฑ (ุตูุงุญูุงุช ูุงููุฉ)</option>
                    </select>
                    <button onclick="addStaff()" class="admin-btn bg-green-600">ุฅูุดุงุก ุงูุญุณุงุจ</button>
                </div>
                <div class="reveal-on-load glass-card p-6">
                    <h3 class="font-black text-lg mb-4">ุงููุณุชุฎุฏููู ุงูุญุงูููู</h3>
                    <div id="staffList" class="space-y-3"></div>
                 </div>
             </div>
        </div>

        <!-- === SETTINGS TAB === -->
        <div id="settings-tab" class="tab-content">
             <h1 class="text-3xl font-black mb-8">ุฅุนุฏุงุฏุงุช ุญุณุงุจู</h1>
            <div class="reveal-on-load glass-card p-8 max-w-md mx-auto">
                <h3 class="font-black text-lg mb-4 text-center">ุชุญุฏูุซ ูููุฉ ุงูุณุฑ</h3>
                <input type="password" id="updatePassIn" class="admin-input mb-4 text-center" placeholder="โขโขโขโขโขโขโขโข">
                <button onclick="updatePassword()" class="admin-btn bg-secondary-color">ุชุญุฏูุซ</button>
            </div>
        </div>
    </main>

    <!-- Global Logic -->
    <script src="pro-logic.js"></script>

    <!-- Page-specific Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Auth & Initial Setup ---
            const session = JSON.parse(localStorage.getItem('activeSession'));
            if (!session) { window.location.href = 'login.html'; return; }

            document.getElementById('userNameDisplay').innerText = session.user;
            document.getElementById('welcome-name').innerText = session.user;

            if (session.role === 'admin') {
                document.getElementById('users-nav-btn').classList.remove('hidden');
            }

            renderAllData();

            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            if(menuToggle) {
                menuToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
            }
        });

        function openTab(id, link) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.sidebar-link').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            link.classList.add('active');
            if (window.innerWidth < 768) {
                document.querySelector('.sidebar').classList.remove('open');
            }
        }

        let restaurants = JSON.parse(localStorage.getItem('barq_restaurants')) || [];
        let offers = JSON.parse(localStorage.getItem('barq_offers')) || [];
        let users = JSON.parse(localStorage.getItem('barq_users')) || [];

        function saveData() {
            localStorage.setItem('barq_restaurants', JSON.stringify(restaurants));
            localStorage.setItem('barq_offers', JSON.stringify(offers));
            localStorage.setItem('barq_users', JSON.stringify(users));
            renderAllData();
        }

        function renderAllData() {
            renderDashboard();
            renderManagementTables();
            renderStaff();
        }
        
        function renderDashboard() {
            document.getElementById('total-restaurants').innerText = restaurants.length;
            const totalMeals = restaurants.reduce((acc, res) => acc + res.menu.length, 0);
            document.getElementById('total-meals').innerText = totalMeals;
            document.getElementById('total-offers').innerText = offers.length;
            document.getElementById('total-users').innerText = users.length;
        }

        function renderManagementTables() {
            const resTable = document.getElementById('resTableBody');
            const offersTable = document.getElementById('offersTableBody');
            const select = document.getElementById('resSelect');

            resTable.innerHTML = restaurants.map(r => `
                <tr class="border-b border-border-color">
                    <td class="py-3 px-2 font-bold">${r.name}</td>
                    <td class="py-3 px-2 text-primary-color font-bold">${r.menu.length} ูุฌุจุฉ</td>
                    <td class="py-3 px-2 text-center"><button onclick="deleteRes(${r.id})" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button></td>
                </tr>
            `).join('') || '<tr><td colspan="3" class="text-center p-4 text-text-light-color">ูุง ุชูุฌุฏ ูุทุงุนู.</td></tr>';
            
            offersTable.innerHTML = offers.map((o, i) => `
                 <tr class="border-b border-border-color">
                    <td class="py-3 px-2 font-bold">${o.name}</td>
                    <td class="py-3 px-2 text-primary-color font-bold">${o.price} ุฑ.ู.</td>
                    <td class="py-3 px-2 text-center"><button onclick="deleteOffer(${i})" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button></td>
                </tr>
            `).join('') || '<tr><td colspan="3" class="text-center p-4 text-text-light-color">ูุง ุชูุฌุฏ ุนุฑูุถ.</td></tr>';

            select.innerHTML = '<option value="">-- ุงุฎุชุฑ ุงููุทุนู --</option>' + 
                restaurants.map(r => `<option value="${r.id}">${r.name}</option>`).join('');
        }

        function addRestaurant() {
            const name = document.getElementById('resName').value;
            const img = document.getElementById('resImg').value;
            if(!name || !img) return alert("ุฃููู ุงูุจูุงูุงุช");
            restaurants.push({ id: Date.now(), name, img, menu: [] });
            document.getElementById('resName').value = '';
            document.getElementById('resImg').value = '';
            saveData();
        }

        function addFood() {
            const resId = document.getElementById('resSelect').value;
            const name = document.getElementById('foodName').value;
            const price = document.getElementById('foodPrice').value;
            if(!resId || !name || !price) return alert("ุฃููู ุงูุจูุงูุงุช");
            const idx = restaurants.findIndex(r => r.id == resId);
            if(idx > -1) {
                restaurants[idx].menu.push({ id: Date.now(), name, price });
                saveData();
                alert("ุชูุช ุงูุฅุถุงูุฉ โ");
            }
        }
        
        function addOffer() {
            const name = document.getElementById('offerName').value;
            const price = document.getElementById('offerPrice').value;
            const img = document.getElementById('offerImg').value;
            const restaurant = document.getElementById('offerRes').value;
            if(!name || !price || !img) return alert("ุฃููู ุงูุจูุงูุงุช");
            offers.push({ id: Date.now(), name, price, img, restaurant });
            saveData();
            alert("ุชู ุฅุถุงูุฉ ุงูุนุฑุถ โ");
        }

        function deleteRes(id) {
            if(JSON.parse(localStorage.getItem('activeSession')).role !== 'admin') return alert("ุตูุงุญูุฉ ุงูุญุฐู ูููุฏูุฑ ููุท!");
            if(confirm("ุญุฐู ุงููุทุนู ููุงุฆูุงูุ")) {
                restaurants = restaurants.filter(r => r.id !== id);
                saveData();
            }
        }
        
         function deleteOffer(index) {
            if(JSON.parse(localStorage.getItem('activeSession')).role !== 'admin') return alert("ุตูุงุญูุฉ ุงูุญุฐู ูููุฏูุฑ ููุท!");
            if(confirm("ุญุฐู ุงูุนุฑุถ ููุงุฆูุงูุ")) {
                offers.splice(index, 1);
                saveData();
            }
        }

        function renderStaff() {
             document.getElementById('staffList').innerHTML = users.map((u, i) => `
                <div class="bg-background-color p-4 rounded-2xl border border-border-color flex justify-between items-center">
                    <div><p class="font-black text-text-color">${u.user}</p><p class="text-[10px] font-bold text-primary-color uppercase">${u.role}</p></div>
                    ${u.user.toLowerCase() !== 'ayman' ? `<button onclick="deleteStaff(${i})" class="text-red-400 hover:text-red-600"><i class="fas fa-user-minus"></i></button>` : ''}
                </div>
            `).join('') || '<p class="text-center p-4 text-text-light-color">ูุง ููุฌุฏ ูุณุชุฎุฏููู.</tr>';
        }

        function addStaff() {
            if(JSON.parse(localStorage.getItem('activeSession')).role !== 'admin') return alert("ุตูุงุญูุฉ ุงูุฅุถุงูุฉ ูููุฏูุฑ ููุท!");
            const u = document.getElementById('newStaffName').value;
            const p = document.getElementById('newStaffPass').value;
            const r = document.getElementById('newStaffRole').value;
            users.push({ user: u, pass: p, role: r });
            saveData();
        }
        
        function deleteStaff(index) {
            if(JSON.parse(localStorage.getItem('activeSession')).role !== 'admin') return alert("ุตูุงุญูุฉ ุงูุญุฐู ูููุฏูุฑ ููุท!");
            if(confirm("ุญุฐู ุงููุณุชุฎุฏู ููุงุฆูุงูุ")) {
                users.splice(index, 1);
                saveData();
            }
        }

        function updatePassword() {
            const newP = document.getElementById('updatePassIn').value;
            if(!newP) return alert("ุฃุฏุฎู ูููุฉ ุงูุณุฑ ุงูุฌุฏูุฏุฉ");
            const session = JSON.parse(localStorage.getItem('activeSession'));
            const idx = users.findIndex(u => u.user === session.user);
            users[idx].pass = newP;
            localStorage.setItem('barq_users', JSON.stringify(users));
            alert("ุชู ุงูุชุญุฏูุซ ุจูุฌุงุญ. ุณูุชู ุชุณุฌูู ุฎุฑูุฌู.");
            logout();
        }

        function logout() { localStorage.removeItem('activeSession'); window.location.href = 'login.html'; }

    </script>
</body>
</html>
