<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ | Ø§Ù„Ø¨Ø±Ù‚ âš¡</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { 
            --main-blue: #0057FF; 
            --main-orange: #FF6B00; 
            --bg-light: #f8faff;
        }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background: var(--bg-light); 
            color: #1e293b; 
            scroll-behavior: smooth;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card { 
            background: white; 
            border-radius: 32px; 
            border: 1px solid rgba(0,0,0,0.03); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.02);
            transition: transform 0.3s ease;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        #map { 
            height: 300px; 
            border-radius: 24px; 
            border: 3px solid #f1f5f9; 
            z-index: 10; 
            width: 100%; 
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        .input-field { 
            background: #f8fafc; 
            border: 2px solid #f1f5f9; 
            border-radius: 20px; 
            padding: 18px; 
            font-weight: 700; 
            width: 100%; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            outline: none; 
            text-align: right; 
        }
        
        .input-field:focus { 
            border-color: var(--main-blue); 
            background: white; 
            box-shadow: 0 10px 20px rgba(0,87,255,0.05);
        }

        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø®ØµØµØ© */
        .payment-card {
            cursor: pointer;
            position: relative;
            border: 2px solid #f1f5f9;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .payment-radio:checked + .payment-content {
            border-color: var(--main-blue);
            background-color: #eff6ff;
        }

        .payment-radio:checked + .payment-content .icon-box {
            background: var(--main-blue);
            color: white;
            transform: scale(1.1);
        }

        .icon-box {
            transition: all 0.3s ease;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ */
        nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 640px) {
            .card { border-radius: 24px; padding: 1.5rem !important; }
            #map { height: 200px; }
        }

        /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-up { animation: slideUp 0.5s ease forwards; }
    </style>
</head>
<body class="pb-10">

    <nav class="fixed top-0 left-0 right-0 z-[1000] py-4 px-[6%] flex justify-between items-center">
        <button onclick="history.back()" class="w-12 h-12 rounded-2xl bg-white shadow-sm border border-gray-100 flex items-center justify-center text-gray-700 hover:bg-blue-600 hover:text-white transition-all active:scale-90">
            <i class="fas fa-arrow-right"></i>
        </button>
        <div class="text-center">
            <span class="block text-xs font-black text-blue-600 uppercase tracking-widest mb-1">Ø§Ù„Ø¨Ø±Ù‚ Ù„Ù„ØªÙˆØµÙŠÙ„</span>
            <h1 class="text-xl font-black text-gray-900 italic">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âš¡</h1>
        </div>
        <div class="w-12"></div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 mt-28 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-7 space-y-6">
            
            <section class="card p-8 animate-up" style="animation-delay: 0.1s">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-black flex items-center gap-3 text-gray-800">
                        <i class="fas fa-shopping-basket text-blue-600 bg-blue-50 p-2 rounded-lg"></i>
                        Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª
                    </h3>
                    <span id="items-count" class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold">0 Ø£ØµÙ†Ø§Ù</span>
                </div>
                
                <div id="cart-list" class="space-y-4 max-h-[400px] overflow-y-auto pr-2">
                    </div>
            </section>

            <section class="card p-8 animate-up" style="animation-delay: 0.2s">
                <h3 class="text-lg font-black mb-6 flex items-center gap-3 text-gray-800">
                    <i class="fas fa-wallet text-blue-600 bg-blue-50 p-2 rounded-lg"></i>
                    Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ù€Ø©
                </h3>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <label class="relative block group">
                        <input type="radio" name="payment_method" value="Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" class="peer hidden payment-radio" checked>
                        <div class="payment-content payment-card p-5 rounded-3xl border-2 flex flex-col items-center text-center gap-3">
                            <div class="icon-box w-12 h-12 bg-gray-50 rounded-2xl flex items-center justify-center text-gray-500">
                                <i class="fas fa-money-bill-wave text-xl"></i>
                            </div>
                            <div>
                                <p class="font-black text-sm text-gray-900">Ù†Ù‚Ø¯Ù‹Ø§ (ÙƒØ§Ø´)</p>
                                <p class="text-[10px] text-gray-400 font-bold">Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</p>
                            </div>
                            <div class="absolute top-3 left-3 opacity-0 peer-checked:opacity-100 transition-opacity">
                                <i class="fas fa-check-circle text-blue-600"></i>
                            </div>
                        </div>
                    </label>

                    <label class="relative block group">
                        <input type="radio" name="payment_method" value="Ø¹Ø¨Ø± Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©" class="peer hidden payment-radio">
                        <div class="payment-content payment-card p-5 rounded-3xl border-2 flex flex-col items-center text-center gap-3">
                            <div class="icon-box w-12 h-12 bg-gray-50 rounded-2xl flex items-center justify-center text-gray-500">
                                <i class="fas fa-mobile-screen text-xl"></i>
                            </div>
                            <div>
                                <p class="font-black text-sm text-gray-900">Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</p>
                                <p class="text-[10px] text-gray-400 font-bold">ÙƒØ±ÙŠÙ…ÙŠ / Ø£Ù… ÙÙ„ÙˆØ³ / ØºÙŠØ±Ù‡Ø§</p>
                            </div>
                            <div class="absolute top-3 left-3 opacity-0 peer-checked:opacity-100 transition-opacity">
                                <i class="fas fa-check-circle text-blue-600"></i>
                            </div>
                        </div>
                    </label>
                </div>
            </section>

            <section class="card p-8 animate-up" style="animation-delay: 0.3s">
                <h3 class="text-lg font-black mb-6 flex items-center gap-3 text-gray-800">
                    <i class="fas fa-map-marker-alt text-blue-600 bg-blue-50 p-2 rounded-lg"></i>
                    Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„
                </h3>
                
                <div class="space-y-5">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="relative">
                            <i class="fas fa-phone absolute right-5 top-5 text-gray-400"></i>
                            <input type="tel" id="user-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" class="input-field pr-12">
                        </div>
                        <div class="relative">
                            <i class="fas fa-map absolute right-5 top-5 text-gray-400"></i>
                            <input type="text" id="user-address" placeholder="ÙˆØµÙ Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù…Ù†Ø²Ù„" class="input-field pr-12">
                        </div>
                    </div>

                    <div class="relative pt-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-sm font-black text-gray-500 italic">Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø© ğŸ“</span>
                            <button onclick="detectLocation()" class="text-xs font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-xl hover:bg-blue-100 transition-colors">
                                <i class="fas fa-location-crosshairs ml-1"></i> ØªØ­Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ GPS
                            </button>
                        </div>
                        <div id="map"></div>
                        <p class="text-[10px] text-gray-400 mt-2 font-bold text-center italic">* ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø§Ù„Ø¶Ø¨Ø·</p>
                    </div>
                </div>
            </section>
        </div>

        <div class="lg:col-span-5">
            <div class="sticky top-28 space-y-6">
                
                <div class="card p-6 border-2 border-dashed border-blue-100 bg-blue-50/20 animate-up" style="animation-delay: 0.4s">
                    <h3 class="text-xs font-black mb-3 text-blue-600">ÙƒÙˆØ¨ÙˆÙ† Ø®ØµÙ… "Ø§Ù„Ø¨Ø±Ù‚" âš¡</h3>
                    <div class="flex gap-2">
                        <input type="text" id="coupon-code" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§" class="input-field py-3 text-center uppercase tracking-widest text-sm">
                        <button onclick="applyCoupon()" class="bg-gray-900 text-white px-6 rounded-2xl font-black text-sm hover:bg-blue-600 transition-all active:scale-90">ØªÙØ¹ÙŠÙ„</button>
                    </div>
                </div>

                <div class="card p-8 bg-gray-900 text-white shadow-2xl shadow-blue-200 animate-up" style="animation-delay: 0.5s">
                    <h3 class="text-xl font-black mb-8 italic border-b border-gray-800 pb-4 flex justify-between">
                        Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        <i class="fas fa-file-invoice-dollar text-gray-700"></i>
                    </h3>
                    
                    <div class="space-y-5 mb-10 text-gray-400 font-bold">
                        <div class="flex justify-between items-center">
                            <span>Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª:</span>
                            <span id="subtotal" class="text-white text-lg font-black">0 Ø±.ÙŠ</span>
                        </div>
                        <div id="discount-row" class="flex justify-between items-center text-green-400 hidden">
                            <span>Ø®ØµÙ… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†:</span>
                            <span id="discount-val" class="font-black">- 0 Ø±.ÙŠ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                            <div class="text-right">
                                <span class="text-blue-400 text-xs block font-black">ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹</span>
                                <span class="text-[9px] text-gray-500">Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</span>
                            </div>
                        </div>
                    </div>

                    <div class="pt-6 border-t border-gray-800 mb-10">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-gray-500 text-xs block font-black mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</span>
                                <span class="text-3xl font-black text-white" id="total-price">0 <small class="text-sm">Ø±.ÙŠ</small></span>
                            </div>
                            <div class="text-left">
                                <i class="fas fa-shield-check text-blue-500 text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <button onclick="sendFinalOrder()" class="w-full bg-[#25D366] text-white py-6 rounded-[24px] font-black text-xl flex items-center justify-center gap-4 shadow-xl hover:bg-[#1fb355] transition-all active:scale-95 group">
                        <i class="fab fa-whatsapp text-3xl group-hover:rotate-12 transition-transform"></i>
                        Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                    </button>
                    
                    <p class="text-[10px] text-gray-500 text-center mt-6 leading-relaxed">
                        Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ØŒ Ø³ÙŠØªÙ… ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„ØªØ£ÙƒÙŠØ¯Ù‡.
                    </p>
                </div>

                <div class="text-center">
                    <button onclick="clearCart()" class="text-xs font-black text-red-400 hover:text-red-600 transition-colors">
                        <i class="fas fa-trash-can ml-1"></i> Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const WHATSAPP_NUMBER = "967775185889"; 
        let map, marker, subtotal = 0, discount = 0, couponUsed = "Ù„Ø§ ÙŠÙˆØ¬Ø¯";

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            renderCartItems();
            initLeafletMap();
        };

        // 1. Ø§Ù„Ø®Ø±Ø§Ø¦Ø·
        function initLeafletMap() {
            try {
                // Ù…Ø±ÙƒØ² ØµÙ†Ø¹Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                const defaultPos = [15.3502, 44.2075];
                map = L.map('map', { zoomControl: false }).setView(defaultPos, 13);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap'
                }).addTo(map);

                marker = L.marker(defaultPos, { draggable: true }).addTo(map);
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                setTimeout(() => map.invalidateSize(), 500);
            } catch (err) {
                console.error("Leaflet Load Error: ", err);
            }
        }

        function detectLocation() {
            if (!navigator.geolocation) return alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
            
            navigator.geolocation.getCurrentPosition(position => {
                const { latitude, longitude } = position.coords;
                const newPos = [latitude, longitude];
                map.setView(newPos, 17);
                marker.setLatLng(newPos);
            }, () => alert("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS ÙÙŠ Ù‡Ø§ØªÙÙƒ"));
        }

        // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø©
        function renderCartItems() {
            const cart = JSON.parse(localStorage.getItem('barq_cart')) || [];
            const container = document.getElementById('cart-list');
            const countLabel = document.getElementById('items-count');
            
            subtotal = 0;
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10">
                        <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-shopping-basket text-gray-200 text-2xl"></i>
                        </div>
                        <p class="text-gray-400 font-bold text-sm">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ØªÙ…Ø§Ù…Ø§Ù‹</p>
                        <a href="index.html" class="text-blue-600 text-xs font-black underline mt-2 inline-block">ØªØµÙØ­ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</a>
                    </div>`;
                updateBillUI();
                return;
            }

            countLabel.innerText = `${cart.length} Ø£ØµÙ†Ø§Ù`;

            container.innerHTML = cart.map((item, index) => {
                const price = parseFloat(item.price) || 0;
                const qty = parseInt(item.quantity) || 1;
                const totalItem = price * qty;
                subtotal += totalItem;

                return `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl border border-gray-100 group hover:bg-white hover:shadow-md transition-all">
                    <div class="flex items-center gap-4">
                        <img src="${item.img || 'https://via.placeholder.com/50'}" class="w-12 h-12 rounded-xl object-cover shadow-sm">
                        <div>
                            <h4 class="font-black text-gray-900 text-sm">${item.name}</h4>
                            <p class="text-[10px] font-bold text-blue-600">${item.restaurantName || 'Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±Ù‚'}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6">
                        <div class="text-left">
                            <span class="block text-xs font-black text-gray-900">${totalItem.toLocaleString()} Ø±.ÙŠ</span>
                            <span class="text-[9px] font-bold text-gray-400">Ø§Ù„ÙƒÙ…ÙŠØ©: ${qty}</span>
                        </div>
                        <button onclick="deleteItem(${index})" class="text-gray-300 hover:text-red-500 transition-colors">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                </div>`;
            }).join('');

            updateBillUI();
        }

        function deleteItem(index) {
            let cart = JSON.parse(localStorage.getItem('barq_cart')) || [];
            cart.splice(index, 1);
            localStorage.setItem('barq_cart', JSON.stringify(cart));
            renderCartItems();
        }

        function clearCart() {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) {
                localStorage.removeItem('barq_cart');
                renderCartItems();
            }
        }

        // 3. Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„ÙƒÙˆØ¨ÙˆÙ†
        function applyCoupon() {
            const code = document.getElementById('coupon-code').value.trim().toUpperCase();
            if (code === "BARQ26" || code === "ALBARQ") {
                discount = 1000;
                couponUsed = code;
                document.getElementById('discount-row').classList.remove('hidden');
                document.getElementById('discount-val').innerText = `- 1,000 Ø±.ÙŠ`;
                alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø®ØµÙ… 1000 Ø±ÙŠØ§Ù„! âœ…");
            } else {
                discount = 0;
                couponUsed = "ØºÙŠØ± ØµØ­ÙŠØ­";
                document.getElementById('discount-row').classList.add('hidden');
                alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­ âŒ");
            }
            updateBillUI();
        }

        function updateBillUI() {
            const finalTotal = Math.max(0, subtotal - discount);
            document.getElementById('subtotal').innerText = `${subtotal.toLocaleString()} Ø±.ÙŠ`;
            document.getElementById('total-price').innerHTML = `${finalTotal.toLocaleString()} <small class="text-sm">Ø±.ÙŠ</small>`;
        }

        // 4. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ù„Ø¯Ù…Ø¬ Ù…Ø¹ ÙˆØ§ØªØ³Ø§Ø¨)
        function sendFinalOrder() {
            const cart = JSON.parse(localStorage.getItem('barq_cart')) || [];
            const phone = document.getElementById('user-phone').value.trim();
            const address = document.getElementById('user-address').value.trim();
            const payMethod = document.querySelector('input[name="payment_method"]:checked').value;

            if (cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©ØŒ Ø£Ø¶Ù ÙˆØ¬Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");
            if (!phone || phone.length < 9) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­");
            if (!address) return alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ÙˆØµÙ Ù„Ù„Ø¹Ù†ÙˆØ§Ù†");

            // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø©
            const pos = marker.getLatLng();
            const mapLink = `https://www.google.com/maps?q=${pos.lat},${pos.lng}`;

            // Ø¨Ù†Ø§Ø¡ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            let msg = `*âš¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯Ø§Ù„Ø¨Ø±Ù‚ Ù„Ù„ØªÙˆØµÙŠÙ„ âš¡*\n`;
            msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            msg += `ğŸ‘¤ *Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:* ${phone}\n`;
            msg += `ğŸ  *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${address}\n`;
            msg += `ğŸ’³ *Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:* ${payMethod}\n`;
            msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            msg += `ğŸ›’ *Ø§Ù„Ø·Ù„Ø¨Ø§Øª:*\n\n`;

            cart.forEach((item, i) => {
                msg += `${i+1}. *${item.name}*\n`;
                msg += `   Ø§Ù„ÙƒÙ…ÙŠØ©: (${item.quantity}) - Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø±.ÙŠ\n`;
                if(item.restaurantName) msg += `   Ø§Ù„Ù…Ø·Ø¹Ù…: ${item.restaurantName}\n`;
                msg += ` \n`;
            });

            msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            if (discount > 0) msg += `ğŸ *Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†:* ${couponUsed} (Ø®ØµÙ… 1000)\n`;
            msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:* ${document.getElementById('total-price').innerText}\n`;
            msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            msg += `ğŸ“ *Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ù„Ø®Ø±ÙŠØ·Ø©):*\n${mapLink}\n`;
            msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            msg += `*ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ÙƒÙ… ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸš€*`;

            // ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
            const finalUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
            window.open(finalUrl, '_blank');
        }
    </script>
</body>
</html>