<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¨Ø±Ù‚ Ù„Ù„ØªÙˆØµÙŠÙ„ - Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª âš¡</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #fcfdfe; margin: 0; padding: 0; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…ÙˆØ­Ø¯ Ù…Ø¹ Ø´Ø¹Ø§Ø± Ù…Ø§Ø¦Ù„ */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 6%; background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            position: fixed; top: 0; left: 0; right: 0; z-index: 2000;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05); height: 80px;
        }

        .nav-links a { text-decoration: none; color: #4b5563; font-weight: 800; font-size: 15px; transition: 0.3s; position: relative; }
        .nav-links a.active { color: #0057FF; }
        .nav-links a.active::after {
            content: ''; position: absolute; bottom: -5px; right: 0;
            width: 100%; height: 3px; background-color: #FF6B00; border-radius: 2px;
        }

        /* ØªØµÙ…ÙŠÙ… ÙƒØ±ÙˆØª Ø§Ù„Ø¹Ø±ÙˆØ¶ */
        .food-card {
            background: white; border-radius: 24px; padding: 15px;
            display: flex; align-items: center; gap: 15px;
            border: 1px solid rgba(0,0,0,0.05); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .food-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0, 87, 255, 0.1); }

        /* Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        #cart-drawer {
            position: fixed; top: 0; left: 0; height: 100%; width: 100%;
            max-width: 400px; background: white; z-index: 3001;
            transform: translateX(-110%); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; box-shadow: 20px 0 50px rgba(0,0,0,0.15);
        }
        #cart-drawer.open { transform: translateX(0); }
        #cart-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000; display: none; backdrop-filter: blur(4px); }
        
        #map { height: 150px; width: 100%; border-radius: 12px; margin-top: 10px; border: 1px solid #ddd; }

        .btn-bolt { background: #0057FF; color: white; border-radius: 12px; rotate: 3deg; }
    </style>
</head>
<body>

    <header>
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.href='index.html'">
            <div class="w-10 h-10 btn-bolt flex items-center justify-center shadow-lg">
                <i class="fas fa-bolt text-white"></i>
            </div>
            <span class="text-xl md:text-2xl font-black text-gray-900 tracking-tighter italic">Ø§Ù„Ù€Ø¨Ù€Ø±Ù‚ Ù„Ù„ØªÙˆØµÙŠÙ„</span>
        </div>
        
        <nav class="nav-links hidden md:flex gap-8">
            <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="restaurants.html">Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</a>
            <a href="offers.html" class="active">Ø§Ù„Ø¹Ø±ÙˆØ¶</a>
            <a href="about.html">Ø¹Ù† Ø§Ù„Ø¨Ø±Ù‚</a>
        </nav>

        <div class="flex items-center gap-3">
            <div class="relative cursor-pointer w-11 h-11 bg-gray-50 rounded-full flex items-center justify-center border border-gray-100" onclick="toggleCart(true)">
                <i class="fas fa-shopping-basket text-lg text-gray-700"></i>
                <span id="cart-badge" class="absolute -top-1 -right-1 bg-[#FF6B00] text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center border-2 border-white font-bold">0</span>
            </div>
            <a href="admin.html" class="w-11 h-11 bg-gray-900 rounded-full flex items-center justify-center text-white"><i class="fas fa-user-shield text-sm"></i></a>
        </div>
    </header>

    <main class="mt-32 px-[6%] container mx-auto min-h-screen">
        <div class="flex justify-between items-end mb-8">
            <h2 class="font-black text-3xl text-gray-800 italic">Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ø¹Ø±ÙˆØ¶ <span class="text-[#0057FF]">Ø§Ù„Ø­ØµØ±ÙŠØ©</span> ğŸ”¥</h2>
        </div>
        
        <div id="offers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </main>

    <div id="cart-overlay" onclick="toggleCart(false)"></div>
    <div id="cart-drawer">
        <div class="p-5 bg-gray-900 text-white flex justify-between items-center">
            <h2 class="font-black italic flex items-center gap-2"><i class="fas fa-shopping-bag text-[#0057FF]"></i> Ø³Ù„Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶</h2>
            <button onclick="toggleCart(false)" class="text-3xl">&times;</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50"></div>
        <div class="p-5 border-t bg-white space-y-3">
            <input type="tel" id="cus-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (7xxxxxxxx)" class="w-full p-4 bg-gray-100 rounded-2xl text-right font-bold outline-none border-2 border-transparent focus:border-[#0057FF] transition-all">
            
            <div class="flex gap-2">
                <button onclick="applyCoupon()" class="bg-gray-800 text-white px-5 rounded-xl font-black">ØªÙØ¹ÙŠÙ„</button>
                <input type="text" id="coupon-code" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…" class="flex-1 p-3 bg-gray-100 rounded-xl text-right font-bold outline-none">
            </div>

            <div class="py-2">
                <button onclick="getUserLocation()" class="w-full bg-blue-50 text-[#0057FF] py-3 rounded-xl font-black text-sm border border-blue-100 flex items-center justify-center gap-2">
                    <i class="fas fa-location-arrow"></i> ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¢Ù† (GPS)
                </button>
                <div id="map"></div>
            </div>

            <div class="flex justify-between items-center py-4 border-t border-dashed">
                <span class="font-black text-gray-500">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                <span id="cart-total" class="text-2xl font-black text-[#0057FF]">0 Ø±ÙŠØ§Ù„</span>
            </div>
            
            <button onclick="checkoutWhatsApp()" class="w-full bg-[#25D366] text-white py-4 rounded-2xl font-black text-lg flex items-center justify-center gap-3 shadow-xl hover:scale-[1.02] transition-transform">
                Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ <i class="fab fa-whatsapp text-2xl"></i>
            </button>
        </div>
    </div>

    <footer class="bg-gray-900 text-white py-12 px-[6%] mt-20 text-center">
        <p class="font-black italic text-[#0057FF] mb-2">Ø§Ù„Ø¨Ø±Ù‚ Ù„Ù„ØªÙˆØµÙŠÙ„âš¡</p>
        <p class="text-gray-500 font-bold text-xs text-center">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2026</p>
    </footer>

    <script>
        const ADMIN_PHONE = "967781110052";
        let discountPercent = 0;
        let map, marker;

        // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© (Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© + Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
        function loadOffers() {
            const container = document.getElementById('offers-container');
            
            // Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯
            const staticOffers = [
                { id: 101, name: "Ø¨Ø±Ù…Ø© Ù„Ø­Ù… Ø¨Ù„Ø¯ÙŠ Ø¹Ø§Ø¦Ù„ÙŠØ©", price: 4500, image: "https://images.unsplash.com/photo-1541518763669-27fef04b14ea?w=400" },
                { id: 102, name: "ÙˆØ¬Ø¨Ø© Ø´ÙˆØ§ÙŠØ© (Ø­Ø¨Ø© ÙƒØ§Ù…Ù„Ø©)", price: 2800, image: "https://images.unsplash.com/photo-1598103442097-8b74394b95c6?w=400" },
                { id: 103, name: "Ø¨Ø±Ø¬Ø± Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ù…Ù„ÙƒÙŠ (Ø¯Ø¨Ù„)", price: 1800, image: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=400" },
                { id: 104, name: "Ø¨ÙŠØªØ²Ø§ Ø¹Ø§Ø¦Ù„ÙŠØ© Ø³ÙˆØ¨Ø±ÙŠÙ…", price: 3500, image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400" }
            ];

            // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            const adminOffers = JSON.parse(localStorage.getItem('barq_offers')) || [];

            // Ø§Ù„Ø¯Ù…Ø¬
            const allOffers = [...staticOffers, ...adminOffers];

            container.innerHTML = allOffers.map((o, i) => `
                <div class="food-card animate-card" style="animation-delay: ${i*0.1}s">
                    <img src="${o.image || o.img}" class="w-24 h-24 rounded-2xl object-cover shadow-md border-2 border-white">
                    <div class="flex-1 text-right">
                        <h3 class="font-black text-gray-800 mb-1">${o.name}</h3>
                        <p class="text-[#0057FF] font-black text-xl">${o.price} <span class="text-xs">Ø±.ÙŠ</span></p>
                    </div>
                    <button onclick="addToCart('${o.name}', ${o.price}, ${o.id})" class="bg-[#0057FF] text-white w-12 h-12 rounded-2xl hover:bg-orange-500 transition-all shadow-lg active:scale-90">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            `).join('');
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø³Ù„Ø© (ØªØ¹Ù…Ù„ Ù…Ø¹ LocalStorage Ø§Ù„Ù…ÙˆØ­Ø¯)
        function getCart() { return JSON.parse(localStorage.getItem('barq_cart')) || []; }
        function saveCart(cart) { 
            localStorage.setItem('barq_cart', JSON.stringify(cart));
            updateBadge();
        }

        function addToCart(name, price, id) {
            let cart = getCart();
            const existing = cart.find(i => i.name === name);
            if(existing) {
                existing.qty++;
            } else {
                cart.push({ id, name, price, qty: 1 });
            }
            saveCart(cart);
            toggleCart(true);
        }

        function toggleCart(show) {
            const drawer = document.getElementById('cart-drawer');
            const overlay = document.getElementById('cart-overlay');
            if(show) {
                drawer.classList.add('open');
                overlay.style.display = 'block';
                renderCartUI();
                setTimeout(initMap, 500);
            } else {
                drawer.classList.remove('open');
                overlay.style.display = 'none';
            }
        }

        function renderCartUI() {
            const cart = getCart();
            const list = document.getElementById('cart-items');
            let total = 0;
            
            if(cart.length === 0) {
                list.innerHTML = '<div class="text-center py-10"><i class="fas fa-shopping-basket text-4xl text-gray-200 mb-2 block"></i><p class="text-gray-400 font-bold">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p></div>';
                document.getElementById('cart-total').innerText = "0 Ø±ÙŠØ§Ù„";
                return;
            }

            list.innerHTML = cart.map((item, index) => {
                total += (item.price * item.qty);
                return `
                <div class="bg-white p-4 rounded-2xl flex justify-between items-center border border-gray-100 shadow-sm">
                    <div class="text-right">
                        <h4 class="font-black text-sm text-gray-800">${item.name}</h4>
                        <p class="text-[#0057FF] font-black text-sm">${item.price * item.qty} Ø±.ÙŠ</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="updateQty(${index}, 1)" class="w-8 h-8 bg-blue-50 text-blue-600 rounded-lg font-bold">+</button>
                        <span class="font-bold text-sm w-4 text-center">${item.qty}</span>
                        <button onclick="updateQty(${index}, -1)" class="w-8 h-8 bg-red-50 text-red-500 rounded-lg font-bold">-</button>
                    </div>
                </div>`;
            }).join('');

            if(discountPercent > 0) total = total * (1 - discountPercent/100);
            document.getElementById('cart-total').innerText = Math.round(total) + " Ø±ÙŠØ§Ù„";
        }

        function updateQty(index, delta) {
            let cart = getCart();
            cart[index].qty += delta;
            if(cart[index].qty <= 0) cart.splice(index, 1);
            saveCart(cart);
            renderCartUI();
        }

        function updateBadge() {
            const cart = getCart();
            document.getElementById('cart-badge').innerText = cart.reduce((s, i) => s + i.qty, 0);
        }

        // Ø§Ù„Ø®Ø±Ø§Ø¦Ø· ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨
        function initMap() {
            if(map) return;
            map = L.map('map').setView([15.3502, 44.2075], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            marker = L.marker([15.3502, 44.2075], {draggable: true}).addTo(map);
        }

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const lat = p.coords.latitude, lng = p.coords.longitude;
                    map.setView([lat, lng], 17);
                    marker.setLatLng([lat, lng]);
                });
            }
        }

        function checkoutWhatsApp() {
            const cart = getCart();
            const phone = document.getElementById('cus-phone').value;
            if(!phone || cart.length === 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ");
            
            const latlng = marker.getLatLng();
            const geoLink = `https://www.google.com/maps?q=${latlng.lat},${latlng.lng}`;
            
            let msg = `*Ø·Ù„Ø¨ Ø¹Ø±ÙˆØ¶ (Ø§Ù„Ø¨Ø±Ù‚ âš¡)*\n\n`;
            cart.forEach(i => msg += `â€¢ ${i.name} (Ã—${i.qty})\n`);
            msg += `\nğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* ${document.getElementById('cart-total').innerText}`;
            msg += `\nğŸ“ *Ø§Ù„Ù‡Ø§ØªÙ:* ${phone}`;
            msg += `\nğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹:* ${geoLink}`;
            
            window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`);
        }

        window.onload = () => { loadOffers(); updateBadge(); };
    </script>
</body>
</html>